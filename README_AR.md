# نظام المحاسبة المالية

تطبيق شامل للمحاسبة ذو القيد المزدوج تم بناؤه باستخدام Flutter لإدارة الحسابات المالية وتسجيل المعاملات وإنشاء البيانات المالية.

## جدول المحتويات

- [تعليمات التثبيت](#تعليمات-التثبيت)
  - [خيارات تثبيت ويندوز](#خيارات-تثبيت-ويندوز)
  - [إلغاء التثبيت](#إلغاء-التثبيت)
- [إعداد بيئة التطوير](#إعداد-بيئة-التطوير)
- [البناء للإنتاج](#البناء-للإنتاج)
- [متطلبات النظام](#متطلبات-النظام)
- [الميزات الرئيسية](#الميزات-الرئيسية)
- [كيفية الاستخدام](#كيفية-الاستخدام)
- [توثيق نماذج البيانات](#توثيق-نماذج-البيانات)
- [العلاقات في قاعدة البيانات](#العلاقات-في-قاعدة-البيانات)
- [تدفق التطبيق](#تدفق-التطبيق)
- [هيكل المشروع](#هيكل-المشروع)

## تعليمات التثبيت

### خيارات تثبيت ويندوز

#### تثبيت حزمة MSIX (موصى به)

1. قم بتشغيل ملف `open_msix_package.bat` للوصول إلى مثبت MSIX
2. أو انتقل مباشرة إلى ملف حزمة MSIX (`FinancialAccounting.msix`) في مجلد `setup_app\WindowsStore`
3. انقر نقرًا مزدوجًا على ملف MSIX للتثبيت باستخدام مثبت تطبيقات ويندوز
4. إذا طُلب منك، انقر على "تثبيت" للتأكيد
5. بعد التثبيت، سيظهر التطبيق في قائمة البدء باسم "نظام المحاسبة المالية"

> **ملاحظة:** إذا لم تجد ملف MSIX، قد تحتاج إلى إنشائه أولاً عن طريق تشغيل:
>
> ```powershell
> flutter pub run msix:create --output-path=setup_app\WindowsStore
> ```
>
> للحصول على تعليمات مفصلة حول الوصول إلى ملف MSIX، راجع [MSIX_ACCESS_GUIDE.md](MSIX_ACCESS_GUIDE.md)

### إلغاء التثبيت

1. افتح إعدادات ويندوز
2. انتقل إلى التطبيقات > التطبيقات المثبتة
3. ابحث عن "نظام المحاسبة المالية" في القائمة
4. انقر على النقاط الثلاث واختر "إلغاء التثبيت"

## إعداد بيئة التطوير

1. تأكد من تثبيت Flutter (https://flutter.dev/docs/get-started/install)
2. تأكد من تثبيت تبعيات تطوير ويندوز:
   ```
   flutter config --enable-windows-desktop
   ```
3. استنسخ هذا المستودع: `git clone https://github.com/zeftawyapps/financel_acc.git`
4. انتقل إلى مجلد المشروع: `cd financel_acc`
5. احصل على التبعيات: `flutter pub get`
6. قم بتشغيل التطبيق: `flutter run -d windows`

### البناء للإنتاج

```powershell
# بناء تطبيق Flutter لـ Windows
flutter build windows --release

# سيكون التطبيق المبني متاحًا في:
# build/windows/x64/runner/Release/

# إنشاء مثبت ويندوز
./build_installer.ps1

# إنشاء حزمة ZIP للتوزيع البديل
./create_release.ps1
```

## متطلبات النظام

- **نظام التشغيل:** ويندوز 10 إصدار 10.0.17763.0 أو أعلى
- **المعالج:** 1.5 جيجاهرتز أو معالج أسرع
- **الذاكرة:** 4 جيجابايت RAM على الأقل
- **التخزين:** 100 ميجابايت مساحة تخزين متاحة
- **العرض:** دقة 1280 × 720 أو أعلى
- **متطلبات إضافية:**
  - Microsoft Visual C++ Redistributable 2015-2019 (مضمنة في المثبت)
  - مثبت تطبيقات ويندوز لتثبيت MSIX

## الميزات الرئيسية

- **دليل الحسابات:** إنشاء وإدارة تسلسل هرمي للحسابات للأصول والخصوم وحقوق الملكية والإيرادات والمصروفات
- **قيود اليومية:** تسجيل معاملات المدين والدائن مع توازن تلقائي
- **دفتر الأستاذ العام:** عرض تاريخ الحسابات التفصيلي مع أرصدة متراكمة
- **البيانات المالية:** إنشاء الميزانيات العمومية وبيانات الدخل
- **واجهة مستخدم عصرية:** واجهة نظيفة وسريعة الاستجابة مع تصميم احترافي

## كيفية الاستخدام

### إعداد الحسابات

1. انتقل إلى شاشة "دليل الحسابات" من القائمة الرئيسية
2. انقر على "إضافة حساب" لإنشاء حسابات جديدة
3. حدد تفاصيل الحساب: الرقم والاسم والنوع والحساب الأصل (إن وجد)
4. نظّم الحسابات في هيكل هرمي لتصنيف مالي أفضل

### تسجيل المعاملات

1. انتقل إلى "قيود اليومية" من القائمة الرئيسية
2. انقر على "قيد يومية جديد"
3. أدخل تاريخ المعاملة ورقم المرجع والوصف
4. أضف إدخالات المدين والدائن مع ضمان توازنها (مبالغ متساوية على كلا الجانبين)
5. احفظ قيد اليومية لتسجيل المعاملة

### عرض دفتر الأستاذ العام

1. انتقل إلى "دفتر الأستاذ العام" من القائمة الرئيسية
2. اختر حسابًا من القائمة المنسدلة
3. اعرض جميع المعاملات المؤثرة على الحساب المحدد مع الأرصدة المتراكمة

### إنشاء البيانات المالية

1. انتقل إلى "البيانات المالية" من القائمة الرئيسية
2. استخدم منتقي التاريخ لتحديد تاريخ التقرير
3. قم بالتبديل بين عرض الميزانية العمومية وبيان الدخل
4. راجع معلومات الوضع المالي أو معلومات الأداء

## توثيق نماذج البيانات

### مخطط العلاقات بين الكيانات

```
┌───────────────────┐       ┌─────────────────────┐      ┌───────────────────┐
│    نوع الحساب     │       │       الحساب        │      │    قيد اليومية    │
├───────────────────┤       ├─────────────────────┤      ├───────────────────┤
│ id (PK)           │       │ id (PK)             │      │ id (PK)           │
│ name              │◄──────┤ typeId (FK)         │◄─────┤ accountId (FK)    │
│ code              │       │ accountNumber        │      │ journalId (FK)────┼──────┐
└───────────────────┘       │ name                │      │ description       │      │
                            │ parentId (FK)───┐   │      │ debit             │      │
                            │ level           │   │      │ credit            │      │
                            │ isActive        │   │      └───────────────────┘      │
                            └─────────────────┼───┘                                 │
                                              │                                     │
                                              └─────────────┐                       │
                                                            ▼                       │
                            ┌────────────────────┐     ┌────────────────────┐       │
                            │    دفتر الأستاذ    │     │   دفتر اليومية     │       │
                            ├────────────────────┤     ├────────────────────┤       │
                            │ id (PK)            │     │ id (PK)            │◄──────┘
                            │ accountId (FK)─────┼─────┤ referenceNumber    │
                            │ journalId (FK)─────┼─────┤ date               │
                            │ entryId (FK)───────┼─────┤ description        │
                            │ date               │     │ isPosted           │
                            │ debit              │     └────────────────────┘
                            │ credit             │
                            │ balance            │
                            └────────────────────┘
```

### تدفق بيانات القوائم المالية

```
                   ┌───────────────────────────────────────────┐
                   │              سجلات دفتر الأستاذ           │
                   └─────────────────┬─────────────────────────┘
                                     │
                         ┌───────────▼────────────┐
                         │        ميزان المراجعة  │
                         └───────────┬────────────┘
                                     │
                   ┌─────────────────┴─────────────────┐
                   ▼                                   ▼
        ┌────────────────────┐             ┌────────────────────┐
        │   الميزانية العمومية │             │     قائمة الدخل    │
        ├────────────────────┤             ├────────────────────┤
        │ - الأصول           │             │ - الإيرادات        │
        │ - الالتزامات       │             │ - المصروفات        │
        │ - حقوق الملكية     │             │ - صافي الدخل        │
        └────────────────────┘             └────────────────────┘
```

### 1. نموذج الحساب

يعتمد نظام المحاسبة على هيكل مرن لدليل الحسابات:

| الخاصية       | النوع          | الوصف                                         |
| ------------- | -------------- | --------------------------------------------- |
| id            | int            | معرّف فريد للحساب                             |
| accountNumber | String         | رمز/رقم الحساب المعياري                       |
| name          | String         | اسم الحساب (مثل "النقد"، "حسابات مدينة")      |
| typeId        | int            | مرجع لنوع الحساب                              |
| parentId      | int (nullable) | معرّف الحساب الأصل للعلاقات الهرمية           |
| level         | int            | العمق في تسلسل الحسابات الهرمي                |
| isActive      | bool           | ما إذا كان الحساب نشطًا                       |
| children      | List<Account>  | الحسابات الفرعية (تستخدم لواجهة المستخدم)     |
| accountType   | AccountType    | معلومات نوع الحساب (تستخدم لواجهة المستخدم)   |
| balance       | double         | الرصيد الحالي للحساب (يستخدم لواجهة المستخدم) |

#### أنواع الحسابات

| الخاصية | النوع  | الوصف                                    |
| ------- | ------ | ---------------------------------------- |
| id      | int    | معرّف فريد لنوع الحساب                   |
| name    | String | اسم النوع (مثل "أصل"، "التزام"، "إيراد") |
| code    | String | رمز النوع المستخدم للمرجعية والتصنيف     |

### 2. نموذج دفتر اليومية

تسجل قيود اليومية المعاملات المالية قبل ترحيلها إلى دفتر الأستاذ العام:

| الخاصية         | النوع              | الوصف                                                |
| --------------- | ------------------ | ---------------------------------------------------- |
| id              | int                | معرّف فريد لدفتر اليومية                             |
| referenceNumber | String             | رقم مرجع فريد لقيد اليومية                           |
| date            | DateTime           | تاريخ قيد اليومية                                    |
| description     | String             | وصف المعاملة                                         |
| isPosted        | bool               | ما إذا كان قيد اليومية قد تم ترحيله إلى دفتر الأستاذ |
| entries         | List<JournalEntry> | البنود الفردية (المدين والدائن)                      |

#### قيد اليومية

| الخاصية       | النوع  | الوصف                               |
| ------------- | ------ | ----------------------------------- |
| id            | int    | معرّف فريد لقيد اليومية             |
| journalId     | int    | مرجع للدفتر الأصل                   |
| accountId     | int    | مرجع للحساب                         |
| description   | String | وصف اختياري لهذا البند              |
| debit         | double | مبلغ المدين (إن وجد)                |
| credit        | double | مبلغ الدائن (إن وجد)                |
| accountName   | String | اسم الحساب (يستخدم لواجهة المستخدم) |
| accountNumber | String | رقم الحساب (يستخدم لواجهة المستخدم) |

### 3. نموذج دفتر الأستاذ

يسجل دفتر الأستاذ جميع المعاملات المرحلة مع أرصدة متراكمة لكل حساب:

| الخاصية         | النوع    | الوصف                                     |
| --------------- | -------- | ----------------------------------------- |
| id              | int      | معرّف فريد لقيد دفتر الأستاذ              |
| accountId       | int      | مرجع للحساب                               |
| journalId       | int      | مرجع لدفتر اليومية المصدر                 |
| entryId         | int      | مرجع لقيد اليومية المصدر                  |
| date            | DateTime | تاريخ المعاملة                            |
| debit           | double   | مبلغ المدين (إن وجد)                      |
| credit          | double   | مبلغ الدائن (إن وجد)                      |
| balance         | double   | الرصيد المتراكم بعد هذا القيد             |
| accountName     | String   | اسم الحساب (يستخدم لواجهة المستخدم)       |
| accountNumber   | String   | رقم الحساب (يستخدم لواجهة المستخدم)       |
| referenceNumber | String   | رقم مرجع اليومية (يستخدم لواجهة المستخدم) |

### 4. نماذج البيانات المالية

#### الميزانية العمومية

| الخاصية                | النوع               | الوصف                                      |
| ---------------------- | ------------------- | ------------------------------------------ |
| asOfDate               | DateTime            | تاريخ الميزانية العمومية                   |
| assets                 | BalanceSheetSection | قسم الأصول مع البنود والإجمالي             |
| liabilities            | BalanceSheetSection | قسم الالتزامات مع البنود والإجمالي         |
| equity                 | BalanceSheetSection | قسم حقوق الملكية مع البنود والإجمالي       |
| totalAssets            | double              | مجموع جميع حسابات الأصول                   |
| totalLiabilitiesEquity | double              | مجموع جميع حسابات الالتزامات وحقوق الملكية |

#### بيان الدخل

| الخاصية   | النوع                  | الوصف                                 |
| --------- | ---------------------- | ------------------------------------- |
| startDate | DateTime               | تاريخ بداية فترة التقرير              |
| endDate   | DateTime               | تاريخ نهاية فترة التقرير              |
| revenue   | IncomeStatementSection | قسم الإيرادات مع البنود والإجمالي     |
| expenses  | IncomeStatementSection | قسم المصروفات مع البنود والإجمالي     |
| netIncome | double                 | الربح/الخسارة (الإيرادات - المصروفات) |

## العلاقات في قاعدة البيانات

```
┌─────────────┐         ┌──────────────┐         ┌─────────────┐
│ AccountType │◄────────┤   Account    │◄────────┤JournalEntry │
└─────────────┘         └──────────────┘         └──────┬──────┘
                             ▲                          │
                             │                          │
                        ┌────┴─────┐              ┌─────▼─────┐
                        │  Ledger   │◄─────────────┤  Journal  │
                        └──────────┘              └───────────┘
```

## تدفق التطبيق

1. **دليل الحسابات**: يتم إنشاء الحسابات وتنظيمها حسب النوع والتسلسل الهرمي
2. **قيود اليومية**: يتم تسجيل المعاملات كقيود يومية مع توازن المدين والدائن
3. **الترحيل**: يتم ترحيل قيود اليومية إلى دفتر الأستاذ العام، مما يؤدي إلى تحديث أرصدة الحسابات
4. **البيانات المالية**: يتم إنشاء الميزانيات العمومية وبيانات الدخل من بيانات دفتر الأستاذ

يطبق نظام المحاسبة المالية هذا مبادئ المحاسبة ذات القيد المزدوج، مما يضمن أنه لكل معاملة، يتساوى دائمًا المدين مع الدائن.

## هيكل المشروع

يتبع نظام المحاسبة المالية هيكل مشروع منظم جيدًا للصيانة وقابلية التوسع:

### هيكل الدلائل

```
financel_acc/
├── lib/                      # كود التطبيق الرئيسي
│   ├── main.dart            # نقطة دخول التطبيق
│   └── lib/                 # كود المكتبة الأساسي
│       ├── Fa-package/      # حزمة المحاسبة المالية
│       │   ├── bloc/        # مكونات منطق الأعمال
│       │   │   ├── account/     # منطق الأعمال المتعلق بالحسابات
│       │   │   ├── journal/     # منطق الأعمال المتعلق بدفتر اليومية
│       │   │   └── ledger/      # منطق الأعمال المتعلق بدفتر الأستاذ
│       │   ├── data/        # طبقة البيانات
│       │   │   ├── database/    # خدمات قاعدة البيانات
│       │   │   ├── models/      # نماذج البيانات
│       │   │   └── repositories/# مستودعات للوصول إلى البيانات
│       └── ui/              # مكونات واجهة المستخدم
│           ├── screens/         # شاشات التطبيق
│           │   ├── accounts/    # شاشات إدارة الحسابات
│           │   ├── financial/   # شاشات البيانات المالية
│           │   ├── journal/     # شاشات قيود اليومية
│           │   └── ledger/      # شاشات دفتر الأستاذ العام
│           ├── theme/           # تكوين السمة
│           └── widgets/         # أدوات واجهة المستخدم القابلة لإعادة الاستخدام
├── windows/                # كود خاص بمنصة ويندوز
├── setup_app/             # حزم التثبيت
│   ├── Installer/         # ملفات مثبت ويندوز
│   ├── Portable/          # حزمة التطبيق المحمولة
│   ├── SharedAssets/      # وثائق وأصول مشتركة
│   └── WindowsStore/      # حزمة متجر ويندوز (MSIX)
└── test/                  # اختبارات التطبيق
```

### مخطط البنية

```
┌─────────────────────────────────────────────────────────────┐
│                        طبقة العرض                          │
│  ┌──────────────┐  ┌─────────────┐  ┌──────────────────────┐ │
│  │ شاشة الرئيسية│  │أدوات واجهة  │  │ تكوين السمة          │ │
│  └──────────────┘  └─────────────┘  └──────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                     طبقة منطق الأعمال                       │
│  ┌──────────────┐  ┌─────────────┐  ┌──────────────────────┐ │
│  │ كتلة الحساب  │  │ كتلة اليومية│  │ كتلة دفتر الأستاذ    │ │
│  └──────────────┘  └─────────────┘  └──────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│                        طبقة البيانات                        │
│  ┌──────────────┐  ┌─────────────┐  ┌──────────────────────┐ │
│  │ المستودعات   │  │نماذج البيانات│  │ خدمة قاعدة البيانات  │ │
│  └──────────────┘  └─────────────┘  └──────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

تتبع هذه البنية نمط BLoC (مكون منطق الأعمال)، والذي يفصل التطبيق إلى ثلاث طبقات رئيسية:

1. **طبقة العرض**: مكونات واجهة المستخدم التي تعرض البيانات وتلتقط إدخال المستخدم
2. **طبقة منطق الأعمال**: مكونات BLoC التي تتعامل مع إدارة الحالة وقواعد الأعمال
3. **طبقة البيانات**: المستودعات والنماذج التي تتعامل مع الوصول إلى البيانات وتخزينها

## هيكل المحاسبة

يطبق هذا التطبيق نظام محاسبة شامل بالهيكل التالي:

- **شجرة الحسابات**: تنظيم هرمي للحسابات بما في ذلك:

  - الأصول
  - الالتزامات
  - حقوق الملكية
  - المصروفات
  - الإيرادات

- **قيود اليومية**: يستخدم التطبيق تنسيق اليومية الأمريكية لتسجيل المعاملات.

- **حسابات دفتر الأستاذ**: يتم ترحيل جميع قيود اليومية إلى حسابات دفتر الأستاذ المناسبة للحفاظ على الأرصدة المستمرة.

- **ميزان المراجعة**: يتم ترحيل الأرصدة النهائية إلى ميزان المراجعة للتحقق.

- **البيانات المالية**: ينشئ النظام تلقائياً:
  - الميزانية العمومية (تظهر الوضع المالي)
  - بيان الدخل (يظهر الأداء المالي)

تم بناء التطبيق باستخدام Flutter مع دعم قاعدة بيانات SQLite (عبر حزمة sqflite_common_ffi) لنظام ويندوز ويطبق نمط BLoC لإدارة الحالة.
